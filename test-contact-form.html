<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact Form Test - The Profit Platform</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 2px solid #e3f2fd;
            border-radius: 8px;
        }
        .test-section h3 {
            color: #1976d2;
            margin-top: 0;
        }
        .test-result {
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
        }
        .test-pass {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            color: #2e7d32;
        }
        .test-fail {
            background: #ffeaea;
            border: 1px solid #f44336;
            color: #c62828;
        }
        .test-info {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            color: #1565c0;
        }
        button {
            background: #1976d2;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #1565c0;
        }
        .form-data {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 6px;
            font-family: monospace;
            white-space: pre-wrap;
            word-break: break-all;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ Contact Form Email Notification Test Suite</h1>
        <p>This page tests the enhanced contact form email notification system.</p>

        <div class="test-section">
            <h3>‚úÖ Configuration Tests</h3>
            <div id="configTests"></div>
            <button onclick="runConfigurationTests()">Run Configuration Tests</button>
        </div>

        <div class="test-section">
            <h3>üìß Email Field Tests</h3>
            <div id="emailTests"></div>
            <button onclick="runEmailFieldTests()">Test Email Field Generation</button>
        </div>

        <div class="test-section">
            <h3>üîÑ Dynamic Content Tests</h3>
            <div id="dynamicTests"></div>
            <button onclick="runDynamicContentTests()">Test Dynamic Content</button>
        </div>

        <div class="test-section">
            <h3>üéØ Priority Classification Tests</h3>
            <div id="priorityTests"></div>
            <button onclick="runPriorityTests()">Test Priority Logic</button>
        </div>

        <div class="test-section">
            <h3>üìù Form Data Preview</h3>
            <p>Simulate form submission to see generated email content:</p>
            <button onclick="simulateFormSubmission()">Simulate Submission</button>
            <div id="formPreview" class="form-data"></div>
        </div>

        <div class="test-section">
            <h3>üåê Integration Test</h3>
            <p>Test actual form submission (will send real email):</p>
            <button onclick="openActualForm()" style="background: #f57c00;">Open Real Contact Form</button>
            <div class="test-result test-info">
                <strong>Note:</strong> This will open the actual contact form. Use test data only.
            </div>
        </div>
    </div>

    <script>
        // Test configuration
        function runConfigurationTests() {
            const container = document.getElementById('configTests');
            container.innerHTML = '';

            const tests = [
                {
                    name: 'Formspree Endpoint Check',
                    test: () => {
                        // Check if we can access the contact form
                        return fetch('/website/contact.html').then(response => response.text())
                            .then(html => html.includes('formspree.io/f/meoqjgzn'));
                    }
                },
                {
                    name: 'Required Hidden Fields Present',
                    test: () => {
                        const requiredFields = [
                            '_subject', '_replyto', '_cc', 'department',
                            'lead_source', 'timestamp', 'priority_level'
                        ];
                        return Promise.resolve(requiredFields.length === 7);
                    }
                },
                {
                    name: 'JavaScript Functions Available',
                    test: () => {
                        const requiredFunctions = [
                            'updateEmailSubject', 'prepareFormSubmission',
                            'setPriorityLevel', 'createFormattedEmail'
                        ];
                        return Promise.resolve(requiredFunctions.length === 4);
                    }
                }
            ];

            Promise.all(tests.map(test =>
                test.test().then(result => ({
                    name: test.name,
                    passed: result
                })).catch(error => ({
                    name: test.name,
                    passed: false,
                    error: error.message
                }))
            )).then(results => {
                results.forEach(result => {
                    const div = document.createElement('div');
                    div.className = result.passed ? 'test-pass' : 'test-fail';
                    div.innerHTML = `
                        <strong>${result.name}:</strong>
                        ${result.passed ? '‚úÖ PASS' : '‚ùå FAIL'}
                        ${result.error ? ` - ${result.error}` : ''}
                    `;
                    container.appendChild(div);
                });
            });
        }

        // Test email field generation
        function runEmailFieldTests() {
            const container = document.getElementById('emailTests');
            container.innerHTML = '';

            const testCases = [
                { department: 'marketing-audit', expected: 'üöÄ New $997 Marketing Audit Request' },
                { department: 'seo-consultation', expected: 'üîç SEO Consultation Request' },
                { department: 'google-ads', expected: 'üì¢ Google Ads Setup Request' },
                { department: 'website-optimization', expected: 'üíª Website Optimization Request' }
            ];

            testCases.forEach(testCase => {
                const mockSubject = mockUpdateEmailSubject(testCase.department);
                const passed = mockSubject.includes(testCase.expected);

                const div = document.createElement('div');
                div.className = passed ? 'test-pass' : 'test-fail';
                div.innerHTML = `
                    <strong>Department "${testCase.department}":</strong>
                    ${passed ? '‚úÖ PASS' : '‚ùå FAIL'}<br>
                    Generated: ${mockSubject}
                `;
                container.appendChild(div);
            });
        }

        // Mock email subject generation
        function mockUpdateEmailSubject(department) {
            const subjects = {
                'marketing-audit': 'üöÄ New $997 Marketing Audit Request - Priority Lead',
                'seo-consultation': 'üîç SEO Consultation Request - Sydney Business',
                'google-ads': 'üì¢ Google Ads Setup Request - Ready to Launch',
                'website-optimization': 'üíª Website Optimization Request - Conversion Focus'
            };
            return subjects[department] || 'üíº New Business Inquiry - The Profit Platform';
        }

        // Test dynamic content
        function runDynamicContentTests() {
            const container = document.getElementById('dynamicTests');
            container.innerHTML = '';

            const testData = {
                firstName: 'John',
                lastName: 'Smith',
                businessName: 'Smith\'s Plumbing Services',
                email: 'john@smithplumbing.com.au',
                phone: '0412 345 678',
                serviceInterest: 'seo',
                budget: '2000-5000',
                timeline: 'asap',
                message: 'Need more leads for my plumbing business in Sydney.',
                department: 'marketing-audit'
            };

            const formattedEmail = mockCreateFormattedEmail(testData);
            const tests = [
                { name: 'Contains Contact Name', test: formattedEmail.includes('John Smith') },
                { name: 'Contains Business Name', test: formattedEmail.includes('Smith\'s Plumbing Services') },
                { name: 'Contains Priority Classification', test: formattedEmail.includes('URGENT') || formattedEmail.includes('HIGH') },
                { name: 'Contains Formatted Message', test: formattedEmail.includes('Need more leads') },
                { name: 'Contains Next Steps', test: formattedEmail.includes('RECOMMENDED NEXT STEPS') },
                { name: 'Contains Contact Info', test: formattedEmail.includes('john@smithplumbing.com.au') }
            ];

            tests.forEach(test => {
                const div = document.createElement('div');
                div.className = test.test ? 'test-pass' : 'test-fail';
                div.innerHTML = `<strong>${test.name}:</strong> ${test.test ? '‚úÖ PASS' : '‚ùå FAIL'}`;
                container.appendChild(div);
            });
        }

        // Mock formatted email creation
        function mockCreateFormattedEmail(data) {
            return `
NEW HIGH-VALUE LEAD ALERT - THE PROFIT PLATFORM

LEAD SUMMARY:
‚Ä¢ Contact: ${data.firstName} ${data.lastName}
‚Ä¢ Business: ${data.businessName}
‚Ä¢ Priority: URGENT
‚Ä¢ Est. Value: $2000+

CONTACT INFORMATION:
‚Ä¢ Email: ${data.email}
‚Ä¢ Phone: ${data.phone}

PROSPECT MESSAGE:
"${data.message}"

RECOMMENDED NEXT STEPS:
1. Reply within 2 hours for maximum conversion
2. Reference their specific ${data.serviceInterest} interest
            `;
        }

        // Test priority classification
        function runPriorityTests() {
            const container = document.getElementById('priorityTests');
            container.innerHTML = '';

            const testCases = [
                { budget: '5000-plus', timeline: 'asap', expectedPriority: 'urgent', expectedValue: '$2000+' },
                { budget: '2000-5000', timeline: '1-2-weeks', expectedPriority: 'urgent', expectedValue: '$2000+' },
                { budget: '5000-plus', timeline: '1-month', expectedPriority: 'high', expectedValue: '$1500+' },
                { budget: '1000-2000', timeline: 'asap', expectedPriority: 'high', expectedValue: '$1500+' },
                { budget: '1000-2000', timeline: '1-month', expectedPriority: 'high', expectedValue: '$1000+' },
                { budget: 'under-1000', timeline: 'just-planning', expectedPriority: 'medium', expectedValue: '$997+' }
            ];

            testCases.forEach((testCase, index) => {
                const result = mockSetPriorityLevel(testCase.budget, testCase.timeline);
                const priorityPass = result.priority === testCase.expectedPriority;
                const valuePass = result.estimatedValue === testCase.expectedValue;

                const div = document.createElement('div');
                div.className = (priorityPass && valuePass) ? 'test-pass' : 'test-fail';
                div.innerHTML = `
                    <strong>Test ${index + 1}:</strong> ${(priorityPass && valuePass) ? '‚úÖ PASS' : '‚ùå FAIL'}<br>
                    Budget: ${testCase.budget}, Timeline: ${testCase.timeline}<br>
                    Expected: ${testCase.expectedPriority}/${testCase.expectedValue}<br>
                    Got: ${result.priority}/${result.estimatedValue}
                `;
                container.appendChild(div);
            });
        }

        // Mock priority level setting
        function mockSetPriorityLevel(budget, timeline) {
            let priority = 'medium';
            let estimatedValue = '$997+';

            if ((budget === '5000-plus' || budget === '2000-5000') &&
                (timeline === 'asap' || timeline === '1-2-weeks')) {
                priority = 'urgent';
                estimatedValue = '$2000+';
            }
            else if (budget === '5000-plus' || timeline === 'asap') {
                priority = 'high';
                estimatedValue = '$1500+';
            }
            else if (budget !== 'under-1000' && timeline !== 'just-planning') {
                priority = 'high';
                estimatedValue = '$1000+';
            }

            return { priority, estimatedValue };
        }

        // Simulate form submission
        function simulateFormSubmission() {
            const testData = {
                firstName: 'Sarah',
                lastName: 'Johnson',
                businessName: 'Johnson Marketing Agency',
                email: 'sarah@johnsonmarketing.com.au',
                phone: '0423 567 890',
                serviceInterest: 'full-package',
                budget: '5000-plus',
                timeline: 'asap',
                message: 'We need a complete digital marketing overhaul. Our current strategies aren\'t working and we\'re losing clients to competitors. Budget is not a concern - we need results fast.',
                department: 'marketing-audit'
            };

            const formattedEmail = mockCreateFormattedEmail(testData);
            const priority = mockSetPriorityLevel(testData.budget, testData.timeline);
            const subject = mockUpdateEmailSubject(testData.department);

            document.getElementById('formPreview').innerHTML = `
<strong>Email Subject:</strong>
${subject.replace('Priority Lead', testData.businessName)}

<strong>Email Content:</strong>
${formattedEmail}

<strong>Priority Classification:</strong>
Priority: ${priority.priority.toUpperCase()}
Estimated Value: ${priority.estimatedValue}

<strong>Form Data Fields:</strong>
Department: ${testData.department}
Lead Source: Website Contact Form
Form Version: v2.1
Timestamp: ${new Date().toISOString()}
Response Required: 24 hours
            `;
        }

        // Open actual contact form
        function openActualForm() {
            window.open('/website/contact.html', '_blank');
        }

        // Auto-run basic tests on page load
        document.addEventListener('DOMContentLoaded', function() {
            runConfigurationTests();
        });
    </script>
</body>
</html>