---
export interface Props {
  title?: string;
  subtitle?: string;
  contactInfo?: {
    phone?: string;
    email?: string;
    address?: string;
    hours?: string;
  };
}

const {
  title = "Let's Start Your Growth Journey",
  subtitle = "Get your free consultation and custom growth strategy within 24 hours",
  contactInfo = {
    phone: "0487 286 451",
    email: "avi@theprofitplatform.com.au",
    address: "Sydney, NSW",
    hours: "Mon-Fri 9am-6pm, Sat 10am-2pm"
  }
} = Astro.props;
---

<section class="contact section animate-on-scroll" id="contact">
  <div class="container">
    <div class="section-header">
      <h2 class="section-title">{title}</h2>
      <p class="section-subtitle">{subtitle}</p>
    </div>

    <div class="contact-container">
      <!-- Contact Form -->
      <div class="contact-form-wrapper">
        <form id="contactForm" class="contact-form" method="POST">
          <div class="form-row">
            <div class="form-group">
              <label for="name">Your Name *</label>
              <input
                type="text"
                id="name"
                name="name"
                required
                placeholder="John Smith"
              >
            </div>
            <div class="form-group">
              <label for="business">Business Name</label>
              <input
                type="text"
                id="business"
                name="business"
                placeholder="Your Business"
              >
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="email">Email Address *</label>
              <input
                type="email"
                id="email"
                name="email"
                required
                placeholder="john@business.com.au"
              >
            </div>
            <div class="form-group">
              <label for="phone">Phone Number *</label>
              <input
                type="tel"
                id="phone"
                name="phone"
                required
                placeholder="0400 000 000"
              >
            </div>
          </div>

          <div class="form-group">
            <label for="service">Service Interested In</label>
            <select id="service" name="service">
              <option value="">Select a service</option>
              <option value="seo">Local SEO</option>
              <option value="google-ads">Google Ads</option>
              <option value="web-design">Web Design</option>
              <option value="full-service">Full Service Marketing</option>
            </select>
          </div>

          <div class="form-group">
            <label for="message">Tell us about your goals</label>
            <textarea
              id="message"
              name="message"
              rows="5"
              placeholder="What are you hoping to achieve with digital marketing?"
            ></textarea>
          </div>

          <!-- Honeypot for spam prevention -->
          <div style="position: absolute; left: -9999px;" aria-hidden="true">
            <label for="website">Website</label>
            <input type="text" id="website" name="website" tabindex="-1" autocomplete="off" aria-hidden="true">
          </div>

          <button type="submit" class="btn btn-primary btn-lg btn-block">
            Get My Free Strategy Session â†’
          </button>

          <p class="form-disclaimer">
            <i class="fas fa-lock"></i> Your information is 100% secure and will never be shared
          </p>
        </form>
      </div>

      <!-- Contact Info -->
      <div class="contact-info-wrapper">
        <div class="contact-info-card">
          <h3>Get in Touch</h3>

          <div class="contact-item">
            <i class="fas fa-phone"></i>
            <div>
              <strong>Call Avi Directly:</strong>
              <a href={`tel:${contactInfo.phone?.replace(/\s/g, '')}`}>
                {contactInfo.phone}
              </a>
            </div>
          </div>

          <div class="contact-item">
            <i class="fas fa-envelope"></i>
            <div>
              <strong>Email Us:</strong>
              <a href={`mailto:${contactInfo.email}`}>
                {contactInfo.email}
              </a>
            </div>
          </div>

          <div class="contact-item">
            <i class="fas fa-map-marker-alt"></i>
            <div>
              <strong>Service Area:</strong>
              <span>{contactInfo.address}</span>
            </div>
          </div>

          <div class="contact-item">
            <i class="fas fa-clock"></i>
            <div>
              <strong>Business Hours:</strong>
              <span>{contactInfo.hours}</span>
            </div>
          </div>

          <div class="response-time">
            <i class="fas fa-bolt"></i>
            <strong>Average Response Time:</strong> 15 minutes during business hours
          </div>

          <div class="social-links">
            <a href="https://facebook.com/theprofitplatform" target="_blank" rel="noopener noreferrer" aria-label="Facebook">
              <i class="fab fa-facebook"></i>
            </a>
            <a href="https://linkedin.com/company/theprofitplatform" target="_blank" rel="noopener noreferrer" aria-label="LinkedIn">
              <i class="fab fa-linkedin"></i>
            </a>
            <a href="https://instagram.com/theprofitplatform" target="_blank" rel="noopener noreferrer" aria-label="Instagram">
              <i class="fab fa-instagram"></i>
            </a>
          </div>
        </div>

        <div class="contact-benefits">
          <h4>What Happens Next?</h4>
          <ul>
            <li><i class="fas fa-check"></i> Quick 15-minute discovery call</li>
            <li><i class="fas fa-check"></i> Free audit of your current marketing</li>
            <li><i class="fas fa-check"></i> Custom growth strategy proposal</li>
            <li><i class="fas fa-check"></i> No obligation to proceed</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  import { initFormHandler, mockSubmitForm } from '../../utils/formHandler';
  import { initScrollAnimations } from '../../utils/animations';

  document.addEventListener('DOMContentLoaded', () => {
    // Initialize scroll animations
    initScrollAnimations('.contact', 'fade-in-up', { threshold: 0.2 });

    // Initialize form handler with proper backend submission
    const formHandler = initFormHandler('#contactForm', {
      // Use mock endpoint for now, replace with actual endpoint when ready
      endpoint: '/api/contact',
      resetOnSuccess: true,
      showToast: true,
      onSuccess: (response) => {
        console.log('Form submitted successfully:', response);

        // Track conversion
        if (typeof window !== 'undefined' && (window as any).gtag) {
          (window as any).gtag('event', 'generate_lead', {
            value: 997,
            currency: 'AUD'
          });
        }
      },
      onError: async (error) => {
        console.error('Form submission error:', error);

        // Fallback to mock submission if backend is not ready
        try {
          const form = document.getElementById('contactForm') as HTMLFormElement;
          const formData = new FormData(form);
          const data = Object.fromEntries(formData);

          await mockSubmitForm(data);

          // Import toast dynamically to avoid SSR issues
          const { toast } = await import('../../utils/toast');
          toast.success('Thank you for your inquiry! We\'ll contact you within 24 hours.');
          form.reset();
        } catch (mockError) {
          const { toast } = await import('../../utils/toast');
          toast.error('Please try again or call us directly.');
        }
      }
    });

    // Add real-time validation feedback
    const inputs = document.querySelectorAll('#contactForm input[required], #contactForm textarea[required]');
    inputs.forEach(input => {
      input.addEventListener('blur', () => {
        const field = input as HTMLInputElement | HTMLTextAreaElement;
        if (!field.value.trim()) {
          field.classList.add('error');
        } else {
          field.classList.remove('error');
        }
      });
    });

    // Phone number formatting
    const phoneInput = document.getElementById('phone') as HTMLInputElement;
    if (phoneInput) {
      phoneInput.addEventListener('input', (e) => {
        const target = e.target as HTMLInputElement;
        let value = target.value.replace(/\D/g, '');

        // Australian phone number formatting
        if (value.length > 0) {
          if (value.length <= 4) {
            value = value.replace(/(\d{4})/, '$1');
          } else if (value.length <= 7) {
            value = value.replace(/(\d{4})(\d{3})/, '$1 $2');
          } else {
            value = value.replace(/(\d{4})(\d{3})(\d{3})/, '$1 $2 $3');
          }
        }

        target.value = value;
      });
    }
  });
</script>

<style>
  .contact-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 3rem;
    margin-top: 3rem;
  }

  .contact-form {
    background: white;
    padding: 2rem;
    border-radius: 10px;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
  }

  .form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
    margin-bottom: 1rem;
  }

  .form-group {
    margin-bottom: 1rem;
  }

  .form-group label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 600;
    color: #1e293b;
  }

  .form-group input,
  .form-group select,
  .form-group textarea {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid #e2e8f0;
    border-radius: 5px;
    font-size: 1rem;
    transition: all 0.2s ease;
  }

  .form-group input:focus,
  .form-group select:focus,
  .form-group textarea:focus {
    outline: none;
    border-color: #2563eb;
    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
  }

  .form-group input.error,
  .form-group textarea.error {
    border-color: #ef4444;
  }

  .form-group input:disabled,
  .form-group select:disabled,
  .form-group textarea:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    background-color: #f3f4f6;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  .animate-spin {
    animation: spin 1s linear infinite;
  }

  .btn-block {
    width: 100%;
    margin-top: 1.5rem;
  }

  .form-disclaimer {
    text-align: center;
    margin-top: 1rem;
    font-size: 0.9rem;
    color: #64748b;
  }

  .contact-info-card {
    background: #f8fafc;
    padding: 2rem;
    border-radius: 10px;
    margin-bottom: 2rem;
  }

  .contact-item {
    display: flex;
    align-items: start;
    gap: 1rem;
    margin-bottom: 1.5rem;
  }

  .contact-item i {
    color: #2563eb;
    font-size: 1.2rem;
    margin-top: 0.25rem;
  }

  .response-time {
    padding: 1rem;
    background: #fef3c7;
    border-radius: 5px;
    margin: 1.5rem 0;
  }

  .social-links {
    display: flex;
    gap: 1rem;
    margin-top: 1.5rem;
  }

  .social-links a {
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #2563eb;
    color: white;
    border-radius: 50%;
    transition: transform 0.3s;
  }

  .social-links a:hover {
    transform: scale(1.1);
  }

  .contact-benefits ul {
    list-style: none;
    padding: 0;
  }

  .contact-benefits li {
    padding: 0.5rem 0;
  }

  .contact-benefits i {
    color: #10b981;
    margin-right: 0.5rem;
  }

  @media (max-width: 768px) {
    .contact-container {
      grid-template-columns: 1fr;
    }

    .form-row {
      grid-template-columns: 1fr;
    }
  }
</style>