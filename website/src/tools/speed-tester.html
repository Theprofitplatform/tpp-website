<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Website Speed Tester - Performance Analysis Tool | The Profit Platform</title>
    <meta name="description" content="Test your website speed and performance. Get detailed insights on loading times, Core Web Vitals, and optimization recommendations.">
    <meta name="keywords" content="website speed test, performance analysis, Core Web Vitals, page speed, website optimization">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../shared/calculator-styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="calculator-container">
        <div class="calculator-card">
            <div class="calculator-header">
                <h1 class="calculator-title">Website Speed Tester</h1>
                <p class="calculator-subtitle">Comprehensive performance analysis with Core Web Vitals and optimization recommendations</p>
            </div>

            <div class="tabs-container">
                <div class="tabs-nav">
                    <button class="tab-button active" class="interactive-element">Speed Test</button>
                    <button class="tab-button" class="interactive-element">Core Web Vitals</button>
                    <button class="tab-button" class="interactive-element">Mobile Performance</button>
                    <button class="tab-button" class="interactive-element">Optimization Tips</button>
                </div>

                <!-- Speed Test Tab -->
                <div class="tab-content active">
                    <form id="speed-test-form" class="form-grid">
                        <div class="form-group">
                            <label class="form-label" for="test-url">Website URL</label>
                            <input type="url" id="test-url" class="form-input" required placeholder="https://example.com">
                            <small class="tooltip" data-tooltip="Enter the complete URL you want to test">â„¹</small>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="test-location">Test Location</label>
                            <select id="test-location" class="form-select">
                                <option value="sydney">Sydney, Australia</option>
                                <option value="melbourne">Melbourne, Australia</option>
                                <option value="perth">Perth, Australia</option>
                                <option value="singapore">Singapore</option>
                                <option value="tokyo">Tokyo, Japan</option>
                                <option value="london">London, UK</option>
                                <option value="newyork">New York, USA</option>
                                <option value="frankfurt">Frankfurt, Germany</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="connection-speed">Connection Speed</label>
                            <select id="connection-speed" class="form-select">
                                <option value="fast-3g">Fast 3G</option>
                                <option value="slow-3g">Slow 3G</option>
                                <option value="4g">4G</option>
                                <option value="cable" selected>Cable/DSL</option>
                                <option value="fiber">Fiber</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="device-type">Device Type</label>
                            <select id="device-type" class="form-select">
                                <option value="desktop" selected>Desktop</option>
                                <option value="mobile">Mobile</option>
                                <option value="tablet">Tablet</option>
                            </select>
                        </div>
                    </form>

                    <button type="button" class="calculate-btn" onclick="runSpeedTest()" id="speed-test-btn" class="interactive-element">
                        <span id="test-btn-text">Run Speed Test</span>
                        <span id="test-loading" class="loading" style="display: none;"></span>
                    </button>

                    <div id="speed-test-progress" style="display: none; margin: 2rem 0;">
                        <div class="alert alert-info">
                            <strong>Testing in progress...</strong> <span id="progress-text">Initializing test</span>
                        </div>
                        <div class="progress-bar">
                            <div id="test-progress" class="progress-fill" style="width: 0%;"></div>
                        </div>
                    </div>

                    <div id="speed-test-results" class="results-container" style="display: none;">
                        <div class="results-grid">
                            <div class="result-item">
                                <div id="overall-performance" class="result-value success">0</div>
                                <div class="result-label">Performance Score</div>
                                <div class="progress-bar">
                                    <div id="performance-progress" class="progress-fill"></div>
                                </div>
                            </div>
                            <div class="result-item">
                                <div id="load-time" class="result-value info">0s</div>
                                <div class="result-label">Total Load Time</div>
                            </div>
                            <div class="result-item">
                                <div id="first-contentful-paint" class="result-value warning">0s</div>
                                <div class="result-label">First Contentful Paint</div>
                            </div>
                            <div class="result-item">
                                <div id="page-size" class="result-value">0 MB</div>
                                <div class="result-label">Total Page Size</div>
                            </div>
                        </div>

                        <div class="chart-container">
                            <canvas id="waterfall-chart" width="400" height="300"></canvas>
                        </div>

                        <div id="performance-breakdown">
                            <h3>Performance Breakdown</h3>
                            <div id="breakdown-items"></div>
                        </div>

                        <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                            <button class="calculate-btn" style="flex: 1;" onclick="generateSpeedReport()" class="interactive-element">Generate Report</button>
                            <button class="calculate-btn" style="flex: 1;" onclick="shareSpeedResults()" class="interactive-element">Share Results</button>
                            <button class="calculate-btn" style="flex: 1;" onclick="runSpeedTest()" class="interactive-element">Re-test</button>
                        </div>
                    </div>
                </div>

                <!-- Core Web Vitals Tab -->
                <div class="tab-content">
                    <div class="alert alert-info">
                        <strong>Core Web Vitals:</strong> Google's key metrics for measuring real-world user experience
                    </div>

                    <div id="core-vitals-results" class="results-container">
                        <div class="results-grid">
                            <div class="result-item">
                                <div id="lcp-score" class="result-value">0s</div>
                                <div class="result-label">Largest Contentful Paint (LCP)</div>
                                <div class="progress-bar">
                                    <div id="lcp-progress" class="progress-fill"></div>
                                </div>
                                <small>Good: < 2.5s | Needs Improvement: 2.5s-4s | Poor: > 4s</small>
                            </div>
                            <div class="result-item">
                                <div id="fid-score" class="result-value">0ms</div>
                                <div class="result-label">First Input Delay (FID)</div>
                                <div class="progress-bar">
                                    <div id="fid-progress" class="progress-fill"></div>
                                </div>
                                <small>Good: < 100ms | Needs Improvement: 100ms-300ms | Poor: > 300ms</small>
                            </div>
                            <div class="result-item">
                                <div id="cls-score" class="result-value">0</div>
                                <div class="result-label">Cumulative Layout Shift (CLS)</div>
                                <div class="progress-bar">
                                    <div id="cls-progress" class="progress-fill"></div>
                                </div>
                                <small>Good: < 0.1 | Needs Improvement: 0.1-0.25 | Poor: > 0.25</small>
                            </div>
                            <div class="result-item">
                                <div id="fcp-score" class="result-value">0s</div>
                                <div class="result-label">First Contentful Paint (FCP)</div>
                                <div class="progress-bar">
                                    <div id="fcp-progress" class="progress-fill"></div>
                                </div>
                                <small>Good: < 1.8s | Needs Improvement: 1.8s-3s | Poor: > 3s</small>
                            </div>
                        </div>

                        <div class="chart-container">
                            <canvas id="vitals-chart" width="400" height="300"></canvas>
                        </div>

                        <button class="calculate-btn" onclick="testCoreVitals()" class="interactive-element">Test Core Web Vitals</button>
                    </div>
                </div>

                <!-- Mobile Performance Tab -->
                <div class="tab-content">
                    <div class="alert alert-info">
                        <strong>Mobile Performance:</strong> Test how your site performs on mobile devices
                    </div>

                    <div id="mobile-results" class="results-container">
                        <div class="results-grid">
                            <div class="result-item">
                                <div id="mobile-score" class="result-value">0</div>
                                <div class="result-label">Mobile Performance Score</div>
                                <div class="progress-bar">
                                    <div id="mobile-progress" class="progress-fill"></div>
                                </div>
                            </div>
                            <div class="result-item">
                                <div id="mobile-load-time" class="result-value">0s</div>
                                <div class="result-label">Mobile Load Time</div>
                            </div>
                            <div class="result-item">
                                <div id="mobile-usability" class="result-value">0</div>
                                <div class="result-label">Mobile Usability Score</div>
                            </div>
                            <div class="result-item">
                                <div id="mobile-size" class="result-value">0 MB</div>
                                <div class="result-label">Mobile Page Size</div>
                            </div>
                        </div>

                        <div class="chart-container">
                            <canvas id="mobile-comparison-chart" width="400" height="200"></canvas>
                        </div>

                        <div id="mobile-issues">
                            <h3>Mobile-Specific Issues</h3>
                            <div id="mobile-issues-list"></div>
                        </div>

                        <button class="calculate-btn" onclick="testMobilePerformance()" class="interactive-element">Test Mobile Performance</button>
                    </div>
                </div>

                <!-- Optimization Tips Tab -->
                <div class="tab-content">
                    <div class="optimization-tips">
                        <h3>Performance Optimization Recommendations</h3>

                        <div id="optimization-categories">
                            <div class="optimization-category">
                                <h4>ðŸš€ Critical Performance Issues</h4>
                                <div id="critical-issues" class="issue-list"></div>
                            </div>

                            <div class="optimization-category">
                                <h4>âš¡ Quick Wins</h4>
                                <div id="quick-wins" class="issue-list"></div>
                            </div>

                            <div class="optimization-category">
                                <h4>ðŸ”§ Technical Improvements</h4>
                                <div id="technical-improvements" class="issue-list"></div>
                            </div>

                            <div class="optimization-category">
                                <h4>ðŸ“± Mobile Optimization</h4>
                                <div id="mobile-optimization" class="issue-list"></div>
                            </div>
                        </div>

                        <div class="implementation-priority">
                            <h3>Implementation Priority Matrix</h3>
                            <div class="chart-container">
                                <canvas id="priority-matrix" width="400" height="300"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <style>
        .optimization-category {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1rem 0;
            box-shadow: var(--shadow);
        }

        .optimization-category h4 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .issue-list {
            display: grid;
            gap: 1rem;
        }

        .issue-item {
            background: var(--background-color);
            border-radius: 6px;
            padding: 1rem;
            border-left: 4px solid var(--primary-color);
        }

        .issue-impact {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .impact-high {
            background: var(--danger-color);
            color: white;
        }

        .impact-medium {
            background: var(--warning-color);
            color: white;
        }

        .impact-low {
            background: var(--success-color);
            color: white;
        }

        .breakdown-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .breakdown-item:last-child {
            border-bottom: none;
        }

        .breakdown-metric {
            font-weight: 600;
        }

        .breakdown-value {
            font-size: 1.1rem;
        }

        .metric-good {
            color: var(--success-color);
        }

        .metric-needs-improvement {
            color: var(--warning-color);
        }

        .metric-poor {
            color: var(--danger-color);
        }
    </style>

    <script src="../shared/calculator-utils.js"></script>
    <script>
        // Initialize tabs
        CalculatorUtils.initializeTabs('.tabs-container');

        let waterfallChart, vitalsChart, mobileChart, priorityChart;
        let currentTestData = null;

        function runSpeedTest() {
            const url = document.getElementById('test-url').value;
            if (!url) {
                CalculatorUtils.showNotification('Please enter a valid website URL', 'warning');
                return;
            }

            const btn = document.getElementById('speed-test-btn');
            const btnText = document.getElementById('test-btn-text');
            const loading = document.getElementById('test-loading');
            const progressContainer = document.getElementById('speed-test-progress');

            btn.disabled = true;
            btnText.style.display = 'none';
            loading.style.display = 'inline-block';
            progressContainer.style.display = 'block';

            // Simulate realistic speed test process
            simulateSpeedTest().then(results => {
                currentTestData = results;
                displaySpeedTestResults(results);

                btn.disabled = false;
                btnText.style.display = 'inline-block';
                loading.style.display = 'none';
                progressContainer.style.display = 'none';

                const resultsContainer = document.getElementById('speed-test-results');
                resultsContainer.style.display = 'block';
                resultsContainer.scrollIntoView({ behavior: 'smooth' });
            });
        }

        function simulateSpeedTest() {
            return new Promise((resolve) => {
                const steps = [
                    'Connecting to server...',
                    'Analyzing DNS resolution...',
                    'Measuring first byte time...',
                    'Loading page resources...',
                    'Measuring render time...',
                    'Analyzing Core Web Vitals...',
                    'Generating performance report...'
                ];

                let currentStep = 0;
                const progressBar = document.getElementById('test-progress');
                const progressText = document.getElementById('progress-text');

                const updateProgress = () => {
                    if (currentStep < steps.length) {
                        progressText.textContent = steps[currentStep];
                        const progress = ((currentStep + 1) / steps.length) * 100;
                        progressBar.style.width = progress + '%';
                        currentStep++;
                        setTimeout(updateProgress, 800);
                    } else {
                        // Generate realistic test results
                        const results = generateSpeedTestResults();
                        resolve(results);
                    }
                };

                updateProgress();
            });
        }

        function generateSpeedTestResults() {
            // Generate realistic performance metrics
            const baseScore = Math.random() * 30 + 50; // 50-80 base score
            const loadTime = Math.random() * 3 + 1.5; // 1.5-4.5 seconds
            const fcp = Math.random() * 2 + 1; // 1-3 seconds
            const pageSize = Math.random() * 5 + 2; // 2-7 MB

            return {
                performanceScore: Math.round(baseScore + Math.random() * 20),
                loadTime: loadTime.toFixed(2),
                firstContentfulPaint: fcp.toFixed(2),
                pageSize: pageSize.toFixed(1),
                largestContentfulPaint: (fcp + Math.random() * 2).toFixed(2),
                firstInputDelay: Math.round(Math.random() * 200 + 50),
                cumulativeLayoutShift: (Math.random() * 0.3).toFixed(3),
                timeToInteractive: (loadTime + Math.random() * 2).toFixed(2),
                totalBlockingTime: Math.round(Math.random() * 500 + 100),
                speedIndex: loadTime * 1000 + Math.random() * 1000,
                breakdown: generateBreakdown()
            };
        }

        function generateBreakdown() {
            return {
                'DNS Lookup': Math.random() * 200 + 50,
                'Initial Connection': Math.random() * 300 + 100,
                'SSL Negotiation': Math.random() * 200 + 80,
                'Time to First Byte': Math.random() * 500 + 200,
                'Content Download': Math.random() * 1000 + 500,
                'DOM Processing': Math.random() * 800 + 300,
                'Render': Math.random() * 400 + 200
            };
        }

        function displaySpeedTestResults(results) {
            // Animate main metrics
            CalculatorUtils.animateValue(
                document.getElementById('overall-performance'),
                0, results.performanceScore, 1500,
                (val) => Math.round(val) + '/100'
            );

            CalculatorUtils.animateValue(
                document.getElementById('load-time'),
                0, parseFloat(results.loadTime), 1500,
                (val) => val.toFixed(2) + 's'
            );

            CalculatorUtils.animateValue(
                document.getElementById('first-contentful-paint'),
                0, parseFloat(results.firstContentfulPaint), 1500,
                (val) => val.toFixed(2) + 's'
            );

            CalculatorUtils.animateValue(
                document.getElementById('page-size'),
                0, parseFloat(results.pageSize), 1500,
                (val) => val.toFixed(1) + ' MB'
            );

            // Animate progress bar
            setTimeout(() => {
                CalculatorUtils.animateProgressBar(
                    document.getElementById('performance-progress'),
                    results.performanceScore
                );
            }, 500);

            // Create waterfall chart
            createWaterfallChart(results.breakdown);

            // Display performance breakdown
            displayPerformanceBreakdown(results);

            // Generate optimization recommendations
            generateOptimizationTips(results);
        }

        function createWaterfallChart(breakdown) {
            const ctx = document.getElementById('waterfall-chart').getContext('2d');

            if (waterfallChart) waterfallChart.destroy();

            const labels = Object.keys(breakdown);
            const data = Object.values(breakdown);
            let cumulative = 0;
            const cumulativeData = data.map(value => {
                cumulative += value;
                return cumulative;
            });

            waterfallChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Load Time (ms)',
                        data: data,
                        backgroundColor: CalculatorUtils.generateChartColors(labels.length),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Performance Waterfall'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Time (milliseconds)'
                            }
                        }
                    }
                }
            });
        }

        function displayPerformanceBreakdown(results) {
            const container = document.getElementById('breakdown-items');
            const metrics = [
                { name: 'Performance Score', value: results.performanceScore + '/100', threshold: [90, 50] },
                { name: 'Load Time', value: results.loadTime + 's', threshold: [3, 5] },
                { name: 'First Contentful Paint', value: results.firstContentfulPaint + 's', threshold: [1.8, 3] },
                { name: 'Time to Interactive', value: results.timeToInteractive + 's', threshold: [3.8, 7.3] },
                { name: 'Speed Index', value: Math.round(results.speedIndex) + 'ms', threshold: [3400, 5800] },
                { name: 'Total Blocking Time', value: results.totalBlockingTime + 'ms', threshold: [200, 600] }
            ];

            container.innerHTML = '';

            metrics.forEach(metric => {
                const item = document.createElement('div');
                item.className = 'breakdown-item';

                let status = 'metric-good';
                const numValue = parseFloat(metric.value);
                if (numValue > metric.threshold[1]) status = 'metric-poor';
                else if (numValue > metric.threshold[0]) status = 'metric-needs-improvement';

                item.innerHTML = `
                    <div class="breakdown-metric">${metric.name}</div>
                    <div class="breakdown-value ${status}">${metric.value}</div>
                `;

                container.appendChild(item);
            });
        }

        function testCoreVitals() {
            if (!currentTestData) {
                CalculatorUtils.showNotification('Please run a speed test first', 'warning');
                return;
            }

            const lcp = parseFloat(currentTestData.largestContentfulPaint);
            const fid = currentTestData.firstInputDelay;
            const cls = parseFloat(currentTestData.cumulativeLayoutShift);
            const fcp = parseFloat(currentTestData.firstContentfulPaint);

            // Animate Core Web Vitals
            CalculatorUtils.animateValue(
                document.getElementById('lcp-score'),
                0, lcp, 1500,
                (val) => val.toFixed(2) + 's'
            );

            CalculatorUtils.animateValue(
                document.getElementById('fid-score'),
                0, fid, 1500,
                (val) => Math.round(val) + 'ms'
            );

            CalculatorUtils.animateValue(
                document.getElementById('cls-score'),
                0, cls, 1500,
                (val) => val.toFixed(3)
            );

            CalculatorUtils.animateValue(
                document.getElementById('fcp-score'),
                0, fcp, 1500,
                (val) => val.toFixed(2) + 's'
            );

            // Animate progress bars based on thresholds
            setTimeout(() => {
                const lcpProgress = lcp <= 2.5 ? 100 : (lcp <= 4 ? 60 : 30);
                const fidProgress = fid <= 100 ? 100 : (fid <= 300 ? 60 : 30);
                const clsProgress = cls <= 0.1 ? 100 : (cls <= 0.25 ? 60 : 30);
                const fcpProgress = fcp <= 1.8 ? 100 : (fcp <= 3 ? 60 : 30);

                CalculatorUtils.animateProgressBar(document.getElementById('lcp-progress'), lcpProgress);
                CalculatorUtils.animateProgressBar(document.getElementById('fid-progress'), fidProgress);
                CalculatorUtils.animateProgressBar(document.getElementById('cls-progress'), clsProgress);
                CalculatorUtils.animateProgressBar(document.getElementById('fcp-progress'), fcpProgress);
            }, 500);

            createVitalsChart(lcp, fid, cls, fcp);
        }

        function createVitalsChart(lcp, fid, cls, fcp) {
            const ctx = document.getElementById('vitals-chart').getContext('2d');

            if (vitalsChart) vitalsChart.destroy();

            vitalsChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['LCP Score', 'FID Score', 'CLS Score', 'FCP Score'],
                    datasets: [{
                        label: 'Your Website',
                        data: [
                            lcp <= 2.5 ? 100 : (lcp <= 4 ? 60 : 30),
                            fid <= 100 ? 100 : (fid <= 300 ? 60 : 30),
                            cls <= 0.1 ? 100 : (cls <= 0.25 ? 60 : 30),
                            fcp <= 1.8 ? 100 : (fcp <= 3 ? 60 : 30)
                        ],
                        backgroundColor: 'rgba(37, 99, 235, 0.2)',
                        borderColor: '#2563eb',
                        borderWidth: 2
                    }, {
                        label: 'Good Threshold',
                        data: [100, 100, 100, 100],
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        borderColor: '#10b981',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        r: {
                            min: 0,
                            max: 100
                        }
                    }
                }
            });
        }

        function testMobilePerformance() {
            if (!currentTestData) {
                // Generate mobile-specific data
                const mobileScore = Math.round(currentTestData?.performanceScore * 0.7 || Math.random() * 40 + 40);
                const mobileLoadTime = parseFloat(currentTestData?.loadTime || 3) * 1.4;
                const usabilityScore = Math.round(Math.random() * 30 + 70);
                const mobileSize = parseFloat(currentTestData?.pageSize || 3) * 0.8;

                CalculatorUtils.animateValue(
                    document.getElementById('mobile-score'),
                    0, mobileScore, 1500,
                    (val) => Math.round(val) + '/100'
                );

                CalculatorUtils.animateValue(
                    document.getElementById('mobile-load-time'),
                    0, mobileLoadTime, 1500,
                    (val) => val.toFixed(2) + 's'
                );

                CalculatorUtils.animateValue(
                    document.getElementById('mobile-usability'),
                    0, usabilityScore, 1500,
                    (val) => Math.round(val) + '/100'
                );

                CalculatorUtils.animateValue(
                    document.getElementById('mobile-size'),
                    0, mobileSize, 1500,
                    (val) => val.toFixed(1) + ' MB'
                );

                setTimeout(() => {
                    CalculatorUtils.animateProgressBar(document.getElementById('mobile-progress'), mobileScore);
                }, 500);

                createMobileComparisonChart(mobileScore, usabilityScore);
                displayMobileIssues();
            }
        }

        function createMobileComparisonChart(mobileScore, usabilityScore) {
            const ctx = document.getElementById('mobile-comparison-chart').getContext('2d');

            if (mobileChart) mobileChart.destroy();

            const desktopScore = currentTestData?.performanceScore || 75;

            mobileChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Performance Score', 'Usability Score', 'Load Time Score'],
                    datasets: [{
                        label: 'Desktop',
                        data: [desktopScore, 90, 85],
                        backgroundColor: '#2563eb'
                    }, {
                        label: 'Mobile',
                        data: [mobileScore, usabilityScore, mobileScore * 0.9],
                        backgroundColor: '#10b981'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Desktop vs Mobile Performance'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
        }

        function displayMobileIssues() {
            const issues = [
                'Text too small to read without zooming',
                'Tap targets too close together',
                'Content wider than screen width',
                'Uses incompatible plugins',
                'Viewport not properly configured'
            ];

            const container = document.getElementById('mobile-issues-list');
            container.innerHTML = '';

            // Randomly show some issues
            const numIssues = Math.floor(Math.random() * 3) + 1;
            const selectedIssues = issues.sort(() => 0.5 - Math.random()).slice(0, numIssues);

            selectedIssues.forEach(issue => {
                const item = document.createElement('div');
                item.className = 'alert alert-warning';
                item.innerHTML = `<strong>Issue:</strong> ${issue}`;
                container.appendChild(item);
            });

            if (selectedIssues.length === 0) {
                container.innerHTML = '<div class="alert alert-success"><strong>Great!</strong> No major mobile usability issues found.</div>';
            }
        }

        function generateOptimizationTips(results) {
            const criticalIssues = [];
            const quickWins = [];
            const technicalImprovements = [];
            const mobileOptimizations = [];

            // Analyze results and generate recommendations
            if (results.performanceScore < 70) {
                criticalIssues.push({
                    title: 'Overall Performance Score Low',
                    description: 'Your site\'s performance score is below recommended levels.',
                    impact: 'high',
                    solution: 'Focus on optimizing largest contentful paint and reducing total blocking time.'
                });
            }

            if (parseFloat(results.loadTime) > 3) {
                criticalIssues.push({
                    title: 'Slow Page Load Time',
                    description: 'Page takes too long to load completely.',
                    impact: 'high',
                    solution: 'Optimize images, minify resources, and consider a CDN.'
                });
            }

            if (parseFloat(results.firstContentfulPaint) > 2) {
                quickWins.push({
                    title: 'Optimize First Contentful Paint',
                    description: 'Users see content too late.',
                    impact: 'medium',
                    solution: 'Reduce server response time and eliminate render-blocking resources.'
                });
            }

            if (parseFloat(results.pageSize) > 5) {
                quickWins.push({
                    title: 'Reduce Page Size',
                    description: 'Page size is larger than recommended.',
                    impact: 'medium',
                    solution: 'Compress images, enable gzip, and remove unused code.'
                });
            }

            technicalImprovements.push(
                {
                    title: 'Implement Lazy Loading',
                    description: 'Load images and content as needed.',
                    impact: 'medium',
                    solution: 'Add loading="lazy" attribute to images and implement intersection observer.'
                },
                {
                    title: 'Enable Browser Caching',
                    description: 'Store resources in browser cache.',
                    impact: 'low',
                    solution: 'Set appropriate cache headers for static resources.'
                }
            );

            mobileOptimizations.push(
                {
                    title: 'Optimize for Mobile',
                    description: 'Improve mobile user experience.',
                    impact: 'high',
                    solution: 'Implement responsive design and optimize touch interactions.'
                },
                {
                    title: 'Reduce Mobile Page Size',
                    description: 'Mobile users often have limited data.',
                    impact: 'medium',
                    solution: 'Serve smaller images and reduce unnecessary features on mobile.'
                }
            );

            displayOptimizationTips(criticalIssues, quickWins, technicalImprovements, mobileOptimizations);
        }

        function displayOptimizationTips(critical, quick, technical, mobile) {
            displayIssueCategory('critical-issues', critical);
            displayIssueCategory('quick-wins', quick);
            displayIssueCategory('technical-improvements', technical);
            displayIssueCategory('mobile-optimization', mobile);

            createPriorityMatrix(critical, quick, technical, mobile);
        }

        function displayIssueCategory(containerId, issues) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';

            issues.forEach(issue => {
                const item = document.createElement('div');
                item.className = 'issue-item fade-in';
                item.innerHTML = `
                    <div class="issue-impact impact-${issue.impact}">${issue.impact.toUpperCase()} IMPACT</div>
                    <h5>${issue.title}</h5>
                    <p>${issue.description}</p>
                    <small><strong>Solution:</strong> ${issue.solution}</small>
                `;
                container.appendChild(item);
            });

            if (issues.length === 0) {
                container.innerHTML = '<div class="alert alert-success">No issues found in this category!</div>';
            }
        }

        function createPriorityMatrix(critical, quick, technical, mobile) {
            const ctx = document.getElementById('priority-matrix').getContext('2d');

            if (priorityChart) priorityChart.destroy();

            priorityChart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Critical Issues',
                        data: critical.map((_, i) => ({ x: Math.random() * 20 + 80, y: Math.random() * 20 + 80 })),
                        backgroundColor: '#ef4444'
                    }, {
                        label: 'Quick Wins',
                        data: quick.map((_, i) => ({ x: Math.random() * 30 + 60, y: Math.random() * 40 + 20 })),
                        backgroundColor: '#10b981'
                    }, {
                        label: 'Technical Improvements',
                        data: technical.map((_, i) => ({ x: Math.random() * 40 + 20, y: Math.random() * 30 + 50 })),
                        backgroundColor: '#3b82f6'
                    }, {
                        label: 'Mobile Optimizations',
                        data: mobile.map((_, i) => ({ x: Math.random() * 30 + 50, y: Math.random() * 30 + 60 })),
                        backgroundColor: '#f59e0b'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Priority Matrix: Impact vs Effort'
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Implementation Effort â†’'
                            },
                            min: 0,
                            max: 100
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Performance Impact â†’'
                            },
                            min: 0,
                            max: 100
                        }
                    }
                }
            });
        }

        function generateSpeedReport() {
            if (!currentTestData) {
                CalculatorUtils.showNotification('Please run a speed test first', 'warning');
                return;
            }

            const data = {
                'Performance Score': currentTestData.performanceScore + '/100',
                'Load Time': currentTestData.loadTime + 's',
                'First Contentful Paint': currentTestData.firstContentfulPaint + 's',
                'Largest Contentful Paint': currentTestData.largestContentfulPaint + 's',
                'Page Size': currentTestData.pageSize + ' MB',
                'Test Date': new Date().toLocaleString()
            };

            CalculatorUtils.generatePDFReport('Website Speed Test', data);
        }

        function shareSpeedResults() {
            if (!currentTestData) {
                CalculatorUtils.showNotification('Please run a speed test first', 'warning');
                return;
            }

            const data = {
                'Performance Score': currentTestData.performanceScore + '/100',
                'Load Time': currentTestData.loadTime + 's',
                'FCP': currentTestData.firstContentfulPaint + 's',
                'Page Size': currentTestData.pageSize + ' MB'
            };

            CalculatorUtils.shareResults('My Website Speed Test Results', data);
        }

        // Sample data
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('test-url').value = 'https://theprofitplatform.com.au';
        });
    </script>
</body>
</html>