<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Budget Optimizer - Marketing Budget Calculator | The Profit Platform</title>
    <meta name="description" content="Optimize your marketing budget across different services. Get data-driven recommendations for SEO, Google Ads, social media, and web design investments.">
    <meta name="keywords" content="budget optimizer, marketing budget calculator, budget allocation, marketing investment planner">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../shared/calculator-styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="calculator-container">
        <div class="calculator-card">
            <div class="calculator-header">
                <h1 class="calculator-title">Budget Optimizer</h1>
                <p class="calculator-subtitle">Optimize your marketing budget allocation across different services for maximum ROI</p>
            </div>

            <div class="tabs-container">
                <div class="tabs-nav">
                    <button class="tab-button active" class="interactive-element">Budget Allocation</button>
                    <button class="tab-button" class="interactive-element">Service Packages</button>
                    <button class="tab-button" class="interactive-element">ROI Projections</button>
                    <button class="tab-button" class="interactive-element">Recommendations</button>
                </div>

                <!-- Budget Allocation Tab -->
                <div class="tab-content active">
                    <form id="budget-form" class="form-grid">
                        <div class="form-group">
                            <label class="form-label" for="total-budget">Total Monthly Budget ($)</label>
                            <input type="number" id="total-budget" class="form-input" min="0" step="100" required placeholder="5000">
                            <small class="tooltip" data-tooltip="Your total available marketing budget per month">ℹ</small>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="business-type">Business Type</label>
                            <select id="business-type" class="form-select" required>
                                <option value="">Select Business Type</option>
                                <option value="ecommerce">E-commerce</option>
                                <option value="local-business">Local Business</option>
                                <option value="b2b-services">B2B Services</option>
                                <option value="professional-services">Professional Services</option>
                                <option value="healthcare">Healthcare</option>
                                <option value="real-estate">Real Estate</option>
                                <option value="restaurant">Restaurant/Food</option>
                                <option value="technology">Technology</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="business-goals">Primary Business Goal</label>
                            <select id="business-goals" class="form-select" required>
                                <option value="">Select Primary Goal</option>
                                <option value="brand-awareness">Brand Awareness</option>
                                <option value="lead-generation">Lead Generation</option>
                                <option value="sales-conversion">Sales Conversion</option>
                                <option value="customer-retention">Customer Retention</option>
                                <option value="market-expansion">Market Expansion</option>
                                <option value="competitive-positioning">Competitive Positioning</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="timeline">Campaign Timeline</label>
                            <select id="timeline" class="form-select" required>
                                <option value="3">3 Months</option>
                                <option value="6">6 Months</option>
                                <option value="12" selected>12 Months</option>
                                <option value="18">18 Months</option>
                                <option value="24">24 Months</option>
                            </select>
                        </div>
                    </form>

                    <!-- Service Allocation Sliders -->
                    <div id="service-allocations">
                        <h3>Service Budget Allocation</h3>
                        <div class="allocation-grid">
                            <div class="allocation-item">
                                <div class="allocation-header">
                                    <label for="seo-slider">SEO Services</label>
                                    <span id="seo-amount">$0</span>
                                </div>
                                <input type="range" id="seo-slider" class="allocation-slider" min="0" max="100" value="30">
                                <div class="slider-labels">
                                    <span>0%</span>
                                    <span id="seo-percentage">30%</span>
                                    <span>100%</span>
                                </div>
                            </div>

                            <div class="allocation-item">
                                <div class="allocation-header">
                                    <label for="ads-slider">Google Ads</label>
                                    <span id="ads-amount">$0</span>
                                </div>
                                <input type="range" id="ads-slider" class="allocation-slider" min="0" max="100" value="25">
                                <div class="slider-labels">
                                    <span>0%</span>
                                    <span id="ads-percentage">25%</span>
                                    <span>100%</span>
                                </div>
                            </div>

                            <div class="allocation-item">
                                <div class="allocation-header">
                                    <label for="social-slider">Social Media</label>
                                    <span id="social-amount">$0</span>
                                </div>
                                <input type="range" id="social-slider" class="allocation-slider" min="0" max="100" value="20">
                                <div class="slider-labels">
                                    <span>0%</span>
                                    <span id="social-percentage">20%</span>
                                    <span>100%</span>
                                </div>
                            </div>

                            <div class="allocation-item">
                                <div class="allocation-header">
                                    <label for="content-slider">Content Marketing</label>
                                    <span id="content-amount">$0</span>
                                </div>
                                <input type="range" id="content-slider" class="allocation-slider" min="0" max="100" value="15">
                                <div class="slider-labels">
                                    <span>0%</span>
                                    <span id="content-percentage">15%</span>
                                    <span>100%</span>
                                </div>
                            </div>

                            <div class="allocation-item">
                                <div class="allocation-header">
                                    <label for="web-slider">Web Design</label>
                                    <span id="web-amount">$0</span>
                                </div>
                                <input type="range" id="web-slider" class="allocation-slider" min="0" max="100" value="10">
                                <div class="slider-labels">
                                    <span>0%</span>
                                    <span id="web-percentage">10%</span>
                                    <span>100%</span>
                                </div>
                            </div>
                        </div>

                        <div class="budget-summary">
                            <div class="summary-item">
                                <span>Total Allocated:</span>
                                <span id="total-allocated">$0</span>
                            </div>
                            <div class="summary-item">
                                <span>Remaining Budget:</span>
                                <span id="remaining-budget">$0</span>
                            </div>
                            <div class="summary-item">
                                <span>Allocation Percentage:</span>
                                <span id="allocation-percentage">0%</span>
                            </div>
                        </div>
                    </div>

                    <button type="button" class="calculate-btn" onclick="optimizeBudget()" class="interactive-element">
                        Optimize Budget Allocation
                    </button>

                    <div id="allocation-results" class="results-container" style="display: none;">
                        <div class="chart-container">
                            <canvas id="allocation-chart" width="400" height="300"></canvas>
                        </div>

                        <div id="optimization-score" class="results-grid">
                            <div class="result-item">
                                <div id="efficiency-score" class="result-value success">0</div>
                                <div class="result-label">Efficiency Score</div>
                            </div>
                            <div class="result-item">
                                <div id="projected-roi" class="result-value info">0%</div>
                                <div class="result-label">Projected ROI</div>
                            </div>
                            <div class="result-item">
                                <div id="risk-level" class="result-value warning">Low</div>
                                <div class="result-label">Risk Level</div>
                            </div>
                            <div class="result-item">
                                <div id="diversification-score" class="result-value">0</div>
                                <div class="result-label">Diversification</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Service Packages Tab -->
                <div class="tab-content">
                    <div class="packages-grid">
                        <div class="package-card">
                            <h3>Starter Package</h3>
                            <div class="package-price">$2,000/month</div>
                            <div class="package-features">
                                <div class="feature-item">
                                    <span class="feature-service">SEO:</span>
                                    <span class="feature-allocation">40% ($800)</span>
                                </div>
                                <div class="feature-item">
                                    <span class="feature-service">Google Ads:</span>
                                    <span class="feature-allocation">35% ($700)</span>
                                </div>
                                <div class="feature-item">
                                    <span class="feature-service">Social Media:</span>
                                    <span class="feature-allocation">15% ($300)</span>
                                </div>
                                <div class="feature-item">
                                    <span class="feature-service">Content:</span>
                                    <span class="feature-allocation">10% ($200)</span>
                                </div>
                            </div>
                            <div class="package-roi">Expected ROI: 180-220%</div>
                            <button class="package-btn" onclick="selectPackage('starter')" class="interactive-element">Select Package</button>
                        </div>

                        <div class="package-card featured">
                            <div class="package-badge">Most Popular</div>
                            <h3>Growth Package</h3>
                            <div class="package-price">$5,000/month</div>
                            <div class="package-features">
                                <div class="feature-item">
                                    <span class="feature-service">SEO:</span>
                                    <span class="feature-allocation">30% ($1,500)</span>
                                </div>
                                <div class="feature-item">
                                    <span class="feature-service">Google Ads:</span>
                                    <span class="feature-allocation">30% ($1,500)</span>
                                </div>
                                <div class="feature-item">
                                    <span class="feature-service">Social Media:</span>
                                    <span class="feature-allocation">20% ($1,000)</span>
                                </div>
                                <div class="feature-item">
                                    <span class="feature-service">Content:</span>
                                    <span class="feature-allocation">15% ($750)</span>
                                </div>
                                <div class="feature-item">
                                    <span class="feature-service">Web Design:</span>
                                    <span class="feature-allocation">5% ($250)</span>
                                </div>
                            </div>
                            <div class="package-roi">Expected ROI: 250-300%</div>
                            <button class="package-btn" onclick="selectPackage('growth')" class="interactive-element">Select Package</button>
                        </div>

                        <div class="package-card">
                            <h3>Enterprise Package</h3>
                            <div class="package-price">$10,000/month</div>
                            <div class="package-features">
                                <div class="feature-item">
                                    <span class="feature-service">SEO:</span>
                                    <span class="feature-allocation">25% ($2,500)</span>
                                </div>
                                <div class="feature-item">
                                    <span class="feature-service">Google Ads:</span>
                                    <span class="feature-allocation">35% ($3,500)</span>
                                </div>
                                <div class="feature-item">
                                    <span class="feature-service">Social Media:</span>
                                    <span class="feature-allocation">20% ($2,000)</span>
                                </div>
                                <div class="feature-item">
                                    <span class="feature-service">Content:</span>
                                    <span class="feature-allocation">15% ($1,500)</span>
                                </div>
                                <div class="feature-item">
                                    <span class="feature-service">Web Design:</span>
                                    <span class="feature-allocation">5% ($500)</span>
                                </div>
                            </div>
                            <div class="package-roi">Expected ROI: 300-400%</div>
                            <button class="package-btn" onclick="selectPackage('enterprise')" class="interactive-element">Select Package</button>
                        </div>
                    </div>

                    <div id="custom-package-builder">
                        <h3>Custom Package Builder</h3>
                        <div class="alert alert-info">
                            Build a custom package based on your specific needs and budget requirements.
                        </div>
                        <button class="calculate-btn" onclick="buildCustomPackage()" class="interactive-element">Build Custom Package</button>
                    </div>
                </div>

                <!-- ROI Projections Tab -->
                <div class="tab-content">
                    <div id="roi-projections" class="results-container">
                        <div class="projection-controls">
                            <div class="form-group">
                                <label class="form-label" for="projection-period">Projection Period</label>
                                <select id="projection-period" class="form-select" onchange="updateProjections()">
                                    <option value="6">6 Months</option>
                                    <option value="12" selected>12 Months</option>
                                    <option value="24">24 Months</option>
                                    <option value="36">36 Months</option>
                                </select>
                            </div>
                        </div>

                        <div class="results-grid">
                            <div class="result-item">
                                <div id="projected-revenue" class="result-value success">$0</div>
                                <div class="result-label">Projected Revenue</div>
                            </div>
                            <div class="result-item">
                                <div id="total-investment" class="result-value info">$0</div>
                                <div class="result-label">Total Investment</div>
                            </div>
                            <div class="result-item">
                                <div id="net-profit-projection" class="result-value warning">$0</div>
                                <div class="result-label">Net Profit</div>
                            </div>
                            <div class="result-item">
                                <div id="break-even-month" class="result-value">0</div>
                                <div class="result-label">Break-even Month</div>
                            </div>
                        </div>

                        <div class="chart-container">
                            <canvas id="roi-projection-chart" width="400" height="300"></canvas>
                        </div>

                        <div class="chart-container">
                            <canvas id="service-performance-chart" width="400" height="200"></canvas>
                        </div>
                    </div>

                    <button class="calculate-btn" onclick="calculateProjections()" class="interactive-element">Calculate ROI Projections</button>
                </div>

                <!-- Recommendations Tab -->
                <div class="tab-content">
                    <div id="recommendations-container">
                        <div class="recommendation-section">
                            <h3>🎯 Budget Optimization Recommendations</h3>
                            <div id="budget-recommendations"></div>
                        </div>

                        <div class="recommendation-section">
                            <h3>📈 Performance Improvement Opportunities</h3>
                            <div id="performance-recommendations"></div>
                        </div>

                        <div class="recommendation-section">
                            <h3>🔄 Reallocation Suggestions</h3>
                            <div id="reallocation-suggestions"></div>
                        </div>

                        <div class="recommendation-section">
                            <h3>⚠️ Risk Mitigation</h3>
                            <div id="risk-recommendations"></div>
                        </div>
                    </div>

                    <div class="action-plan">
                        <h3>📋 30-60-90 Day Action Plan</h3>
                        <div class="action-timeline">
                            <div class="timeline-item">
                                <div class="timeline-marker">30</div>
                                <div class="timeline-content">
                                    <h4>Days 1-30: Foundation</h4>
                                    <ul id="days-30-plan"></ul>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-marker">60</div>
                                <div class="timeline-content">
                                    <h4>Days 31-60: Optimization</h4>
                                    <ul id="days-60-plan"></ul>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-marker">90</div>
                                <div class="timeline-content">
                                    <h4>Days 61-90: Scaling</h4>
                                    <ul id="days-90-plan"></ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                        <button class="calculate-btn" style="flex: 1;" onclick="generateBudgetReport()" class="interactive-element">Generate Report</button>
                        <button class="calculate-btn" style="flex: 1;" onclick="shareBudgetResults()" class="interactive-element">Share Plan</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <style>
        .allocation-grid {
            display: grid;
            gap: 2rem;
            margin: 2rem 0;
        }

        .allocation-item {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: var(--shadow);
        }

        .allocation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .allocation-header label {
            font-weight: 600;
            color: var(--text-color);
        }

        .allocation-slider {
            width: 100%;
            height: 6px;
            background: var(--border-color);
            border-radius: 3px;
            outline: none;
            margin: 1rem 0;
        }

        .allocation-slider::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            background: var(--primary-color);
            border-radius: 50%;
            cursor: pointer;
        }

        .slider-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.875rem;
            color: var(--text-muted);
        }

        .budget-summary {
            background: var(--background-color);
            border-radius: 8px;
            padding: 1.5rem;
            margin: 2rem 0;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .summary-item:last-child {
            margin-bottom: 0;
            font-weight: 700;
            color: var(--primary-color);
        }

        .packages-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }

        .package-card {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: var(--shadow);
            border: 2px solid var(--border-color);
            position: relative;
            transition: all 0.3s ease;
        }

        .package-card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-4px);
        }

        .package-card.featured {
            border-color: var(--primary-color);
            background: linear-gradient(135deg, #ffffff, #f8fafc);
        }

        .package-badge {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--primary-color);
            color: white;
            padding: 4px 16px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .package-card h3 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: var(--text-color);
        }

        .package-price {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 1.5rem;
        }

        .package-features {
            margin-bottom: 1.5rem;
        }

        .feature-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .feature-item:last-child {
            border-bottom: none;
        }

        .feature-service {
            font-weight: 500;
        }

        .feature-allocation {
            color: var(--primary-color);
            font-weight: 600;
        }

        .package-roi {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
            padding: 0.5rem 1rem;
            border-radius: 4px;
            text-align: center;
            font-weight: 600;
            margin-bottom: 1.5rem;
        }

        .package-btn {
            width: 100%;
            padding: 12px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .package-btn:hover {
            background: var(--primary-hover);
            transform: translateY(-2px);
        }

        .projection-controls {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
        }

        .recommendation-section {
            background: white;
            border-radius: 8px;
            padding: 2rem;
            margin: 1.5rem 0;
            box-shadow: var(--shadow);
        }

        .recommendation-section h3 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .recommendation-item {
            background: var(--background-color);
            border-radius: 6px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid var(--primary-color);
        }

        .action-timeline {
            margin: 2rem 0;
        }

        .timeline-item {
            display: flex;
            margin: 2rem 0;
        }

        .timeline-marker {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.2rem;
            margin-right: 2rem;
            flex-shrink: 0;
        }

        .timeline-content {
            flex: 1;
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: var(--shadow);
        }

        .timeline-content h4 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .timeline-content ul {
            margin: 0;
            padding-left: 1rem;
        }

        .timeline-content li {
            margin-bottom: 0.5rem;
        }

        @media (max-width: 768px) {
            .timeline-item {
                flex-direction: column;
                text-align: center;
            }

            .timeline-marker {
                margin: 0 auto 1rem auto;
            }
        }
    </style>

    <script src="../shared/calculator-utils.js"></script>
    <script>
        // Initialize tabs
        CalculatorUtils.initializeTabs('.tabs-container');

        let allocationChart, roiProjectionChart, servicePerformanceChart;
        let currentBudgetData = {};

        // Budget allocation sliders
        const sliders = ['seo', 'ads', 'social', 'content', 'web'];

        sliders.forEach(service => {
            const slider = document.getElementById(`${service}-slider`);
            slider.addEventListener('input', updateAllocation);
        });

        document.getElementById('total-budget').addEventListener('input', updateAllocation);

        function updateAllocation() {
            const totalBudget = parseFloat(document.getElementById('total-budget').value) || 0;
            let totalPercentage = 0;

            sliders.forEach(service => {
                const slider = document.getElementById(`${service}-slider`);
                const percentage = parseInt(slider.value);
                const amount = (totalBudget * percentage) / 100;

                document.getElementById(`${service}-percentage`).textContent = percentage + '%';
                document.getElementById(`${service}-amount`).textContent = CalculatorUtils.formatCurrency(amount);

                totalPercentage += percentage;
            });

            const totalAllocated = (totalBudget * totalPercentage) / 100;
            const remaining = totalBudget - totalAllocated;

            document.getElementById('total-allocated').textContent = CalculatorUtils.formatCurrency(totalAllocated);
            document.getElementById('remaining-budget').textContent = CalculatorUtils.formatCurrency(remaining);
            document.getElementById('allocation-percentage').textContent = totalPercentage + '%';

            // Update colors based on allocation status
            const allocationPercentageElement = document.getElementById('allocation-percentage');
            if (totalPercentage === 100) {
                allocationPercentageElement.style.color = 'var(--success-color)';
            } else if (totalPercentage > 100) {
                allocationPercentageElement.style.color = 'var(--danger-color)';
            } else {
                allocationPercentageElement.style.color = 'var(--warning-color)';
            }
        }

        function optimizeBudget() {
            const totalBudget = parseFloat(document.getElementById('total-budget').value);
            const businessType = document.getElementById('business-type').value;
            const businessGoals = document.getElementById('business-goals').value;

            if (!totalBudget || !businessType || !businessGoals) {
                CalculatorUtils.showNotification('Please fill in all required fields', 'warning');
                return;
            }

            const optimization = calculateOptimalAllocation(totalBudget, businessType, businessGoals);

            // Apply optimization suggestions
            applyOptimalAllocation(optimization);

            // Display results
            displayOptimizationResults(optimization);

            const resultsContainer = document.getElementById('allocation-results');
            resultsContainer.style.display = 'block';
            resultsContainer.scrollIntoView({ behavior: 'smooth' });
        }

        function calculateOptimalAllocation(budget, businessType, goals) {
            // Business type multipliers
            const businessTypeAllocation = {
                'ecommerce': { seo: 25, ads: 35, social: 20, content: 15, web: 5 },
                'local-business': { seo: 40, ads: 30, social: 15, content: 10, web: 5 },
                'b2b-services': { seo: 35, ads: 20, social: 15, content: 25, web: 5 },
                'professional-services': { seo: 30, ads: 25, social: 20, content: 20, web: 5 },
                'healthcare': { seo: 45, ads: 25, social: 10, content: 15, web: 5 },
                'real-estate': { seo: 30, ads: 40, social: 15, content: 10, web: 5 },
                'restaurant': { seo: 20, ads: 25, social: 35, content: 15, web: 5 },
                'technology': { seo: 40, ads: 20, social: 15, content: 20, web: 5 }
            };

            // Goal adjustments
            const goalAdjustments = {
                'brand-awareness': { seo: -5, ads: 10, social: 10, content: -10, web: -5 },
                'lead-generation': { seo: 10, ads: 5, social: -5, content: -5, web: -5 },
                'sales-conversion': { seo: -5, ads: 15, social: -5, content: -5, web: 0 },
                'customer-retention': { seo: 5, ads: -10, social: 10, content: 5, web: -10 },
                'market-expansion': { seo: 5, ads: 10, social: 5, content: -15, web: -5 },
                'competitive-positioning': { seo: 10, ads: 5, social: 0, content: -10, web: -5 }
            };

            const baseAllocation = businessTypeAllocation[businessType] || businessTypeAllocation['professional-services'];
            const adjustments = goalAdjustments[goals] || {};

            const optimized = {};
            let total = 0;

            Object.keys(baseAllocation).forEach(service => {
                optimized[service] = Math.max(0, Math.min(100, baseAllocation[service] + (adjustments[service] || 0)));
                total += optimized[service];
            });

            // Normalize to 100%
            Object.keys(optimized).forEach(service => {
                optimized[service] = Math.round((optimized[service] / total) * 100);
            });

            // Calculate scores
            const efficiencyScore = calculateEfficiencyScore(optimized, businessType, goals);
            const projectedROI = calculateProjectedROI(optimized, businessType);
            const riskLevel = calculateRiskLevel(optimized);
            const diversificationScore = calculateDiversificationScore(optimized);

            return {
                allocation: optimized,
                scores: {
                    efficiency: efficiencyScore,
                    roi: projectedROI,
                    risk: riskLevel,
                    diversification: diversificationScore
                }
            };
        }

        function calculateEfficiencyScore(allocation, businessType, goals) {
            // Complex algorithm considering multiple factors
            let score = 70; // Base score

            // Industry-specific bonuses
            const industryBonuses = {
                'ecommerce': allocation.ads > 30 ? 10 : 0,
                'local-business': allocation.seo > 35 ? 15 : 0,
                'b2b-services': allocation.content > 20 ? 10 : 0
            };

            score += industryBonuses[businessType] || 0;

            // Goal alignment bonuses
            if (goals === 'lead-generation' && allocation.seo > 25) score += 10;
            if (goals === 'brand-awareness' && allocation.social > 20) score += 8;

            // Diversification bonus
            const nonZeroServices = Object.values(allocation).filter(val => val > 0).length;
            if (nonZeroServices >= 4) score += 10;

            return Math.min(100, score);
        }

        function calculateProjectedROI(allocation, businessType) {
            const baseROI = 180; // Base ROI percentage

            // Service ROI multipliers
            const roiMultipliers = {
                seo: 2.2,
                ads: 1.8,
                social: 1.5,
                content: 2.0,
                web: 1.3
            };

            let weightedROI = 0;
            Object.keys(allocation).forEach(service => {
                weightedROI += (allocation[service] / 100) * roiMultipliers[service];
            });

            return Math.round(baseROI * weightedROI);
        }

        function calculateRiskLevel(allocation) {
            const maxAllocation = Math.max(...Object.values(allocation));
            if (maxAllocation > 50) return 'High';
            if (maxAllocation > 35) return 'Medium';
            return 'Low';
        }

        function calculateDiversificationScore(allocation) {
            const nonZeroServices = Object.values(allocation).filter(val => val > 0).length;
            const variance = calculateVariance(Object.values(allocation));

            return Math.round((nonZeroServices * 20) - (variance / 10));
        }

        function calculateVariance(values) {
            const mean = values.reduce((sum, val) => sum + val, 0) / values.length;
            return values.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / values.length;
        }

        function applyOptimalAllocation(optimization) {
            Object.keys(optimization.allocation).forEach(service => {
                const slider = document.getElementById(`${service}-slider`);
                slider.value = optimization.allocation[service];
            });
            updateAllocation();
        }

        function displayOptimizationResults(optimization) {
            // Store current data
            currentBudgetData = optimization;

            // Animate scores
            CalculatorUtils.animateValue(
                document.getElementById('efficiency-score'),
                0, optimization.scores.efficiency, 1500,
                (val) => Math.round(val) + '/100'
            );

            CalculatorUtils.animateValue(
                document.getElementById('projected-roi'),
                0, optimization.scores.roi, 1500,
                (val) => Math.round(val) + '%'
            );

            document.getElementById('risk-level').textContent = optimization.scores.risk;

            CalculatorUtils.animateValue(
                document.getElementById('diversification-score'),
                0, optimization.scores.diversification, 1500,
                (val) => Math.round(val) + '/100'
            );

            // Create allocation chart
            createAllocationChart(optimization.allocation);

            // Generate recommendations
            generateRecommendations(optimization);
        }

        function createAllocationChart(allocation) {
            const ctx = document.getElementById('allocation-chart').getContext('2d');

            if (allocationChart) allocationChart.destroy();

            const totalBudget = parseFloat(document.getElementById('total-budget').value) || 0;

            allocationChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['SEO Services', 'Google Ads', 'Social Media', 'Content Marketing', 'Web Design'],
                    datasets: [{
                        data: [
                            allocation.seo,
                            allocation.ads,
                            allocation.social,
                            allocation.content,
                            allocation.web
                        ],
                        backgroundColor: CalculatorUtils.generateChartColors(5),
                        borderWidth: 3,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: `Optimized Budget Allocation - ${CalculatorUtils.formatCurrency(totalBudget)}/month`
                        },
                        legend: {
                            position: 'bottom'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const percentage = context.parsed;
                                    const amount = (totalBudget * percentage) / 100;
                                    return `${context.label}: ${percentage}% (${CalculatorUtils.formatCurrency(amount)})`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function selectPackage(packageType) {
            const packages = {
                'starter': {
                    budget: 2000,
                    allocation: { seo: 40, ads: 35, social: 15, content: 10, web: 0 }
                },
                'growth': {
                    budget: 5000,
                    allocation: { seo: 30, ads: 30, social: 20, content: 15, web: 5 }
                },
                'enterprise': {
                    budget: 10000,
                    allocation: { seo: 25, ads: 35, social: 20, content: 15, web: 5 }
                }
            };

            const selectedPackage = packages[packageType];

            document.getElementById('total-budget').value = selectedPackage.budget;

            Object.keys(selectedPackage.allocation).forEach(service => {
                const slider = document.getElementById(`${service}-slider`);
                slider.value = selectedPackage.allocation[service];
            });

            updateAllocation();

            CalculatorUtils.showNotification(`${packageType.charAt(0).toUpperCase() + packageType.slice(1)} package selected!`, 'success');
        }

        function calculateProjections() {
            const totalBudget = parseFloat(document.getElementById('total-budget').value) || 0;
            const projectionPeriod = parseInt(document.getElementById('projection-period').value) || 12;

            if (!totalBudget) {
                CalculatorUtils.showNotification('Please set your budget first', 'warning');
                return;
            }

            const totalInvestment = totalBudget * projectionPeriod;
            const projectedROI = currentBudgetData.scores?.roi || 200;
            const projectedRevenue = totalInvestment * (projectedROI / 100);
            const netProfit = projectedRevenue - totalInvestment;
            const breakEvenMonth = Math.ceil(totalInvestment / (projectedRevenue / projectionPeriod));

            // Animate values
            CalculatorUtils.animateValue(
                document.getElementById('projected-revenue'),
                0, projectedRevenue, 2000,
                (val) => CalculatorUtils.formatCurrency(val)
            );

            CalculatorUtils.animateValue(
                document.getElementById('total-investment'),
                0, totalInvestment, 2000,
                (val) => CalculatorUtils.formatCurrency(val)
            );

            CalculatorUtils.animateValue(
                document.getElementById('net-profit-projection'),
                0, netProfit, 2000,
                (val) => CalculatorUtils.formatCurrency(val)
            );

            CalculatorUtils.animateValue(
                document.getElementById('break-even-month'),
                0, breakEvenMonth, 1500,
                (val) => 'Month ' + Math.round(val)
            );

            createROIProjectionChart(projectionPeriod, totalBudget, projectedROI);
            createServicePerformanceChart();
        }

        function createROIProjectionChart(period, monthlyBudget, roiPercentage) {
            const ctx = document.getElementById('roi-projection-chart').getContext('2d');

            if (roiProjectionChart) roiProjectionChart.destroy();

            const months = [];
            const investment = [];
            const revenue = [];
            let cumulativeInvestment = 0;
            let cumulativeRevenue = 0;

            for (let i = 1; i <= period; i++) {
                months.push(`Month ${i}`);
                cumulativeInvestment += monthlyBudget;
                cumulativeRevenue += (monthlyBudget * (roiPercentage / 100)) * (i / period); // Gradual ROI increase

                investment.push(cumulativeInvestment);
                revenue.push(cumulativeRevenue);
            }

            roiProjectionChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [{
                        label: 'Cumulative Investment',
                        data: investment,
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        borderColor: '#ef4444',
                        borderWidth: 2,
                        fill: false
                    }, {
                        label: 'Projected Revenue',
                        data: revenue,
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        borderColor: '#10b981',
                        borderWidth: 2,
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'ROI Projection Over Time'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return CalculatorUtils.formatCurrency(value);
                                }
                            }
                        }
                    }
                }
            });
        }

        function createServicePerformanceChart() {
            const ctx = document.getElementById('service-performance-chart').getContext('2d');

            if (servicePerformanceChart) servicePerformanceChart.destroy();

            // Simulate service performance metrics
            const services = ['SEO', 'Google Ads', 'Social Media', 'Content', 'Web Design'];
            const leadGeneration = [85, 70, 45, 60, 30];
            const brandAwareness = [90, 75, 85, 80, 40];

            servicePerformanceChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: services,
                    datasets: [{
                        label: 'Lead Generation',
                        data: leadGeneration,
                        backgroundColor: 'rgba(37, 99, 235, 0.2)',
                        borderColor: '#2563eb',
                        borderWidth: 2
                    }, {
                        label: 'Brand Awareness',
                        data: brandAwareness,
                        backgroundColor: 'rgba(16, 185, 129, 0.2)',
                        borderColor: '#10b981',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Service Performance by Objective'
                        }
                    },
                    scales: {
                        r: {
                            min: 0,
                            max: 100
                        }
                    }
                }
            });
        }

        function generateRecommendations(optimization) {
            const budgetRecommendations = document.getElementById('budget-recommendations');
            const performanceRecommendations = document.getElementById('performance-recommendations');
            const reallocationSuggestions = document.getElementById('reallocation-suggestions');
            const riskRecommendations = document.getElementById('risk-recommendations');

            // Budget recommendations
            budgetRecommendations.innerHTML = `
                <div class="recommendation-item">
                    <h5>Increase SEO Investment</h5>
                    <p>Your current SEO allocation of ${optimization.allocation.seo}% is optimal for long-term growth. Consider increasing by 5% if budget allows.</p>
                </div>
                <div class="recommendation-item">
                    <h5>Balance Paid vs Organic</h5>
                    <p>Your paid advertising (${optimization.allocation.ads}%) and organic efforts are well balanced for sustainable growth.</p>
                </div>
            `;

            // Performance recommendations
            performanceRecommendations.innerHTML = `
                <div class="recommendation-item">
                    <h5>Implement Conversion Tracking</h5>
                    <p>Set up proper analytics and conversion tracking to measure ROI across all channels accurately.</p>
                </div>
                <div class="recommendation-item">
                    <h5>A/B Testing Strategy</h5>
                    <p>Allocate 10% of your budget to testing new strategies and optimizing existing campaigns.</p>
                </div>
            `;

            // Reallocation suggestions
            if (optimization.scores.risk === 'High') {
                reallocationSuggestions.innerHTML = `
                    <div class="recommendation-item">
                        <h5>Reduce Concentration Risk</h5>
                        <p>Your budget is heavily concentrated in one channel. Consider diversifying to reduce risk.</p>
                    </div>
                `;
            } else {
                reallocationSuggestions.innerHTML = `
                    <div class="recommendation-item">
                        <h5>Current Allocation is Balanced</h5>
                        <p>Your budget distribution shows good diversification. Monitor performance and adjust quarterly.</p>
                    </div>
                `;
            }

            // Risk recommendations
            riskRecommendations.innerHTML = `
                <div class="recommendation-item">
                    <h5>Monthly Review Schedule</h5>
                    <p>Conduct monthly budget reviews to ensure optimal allocation based on performance data.</p>
                </div>
                <div class="recommendation-item">
                    <h5>Emergency Fund</h5>
                    <p>Keep 10-15% of your budget as an emergency fund for opportunities or crisis management.</p>
                </div>
            `;

            // Generate action plans
            generateActionPlans();
        }

        function generateActionPlans() {
            const days30 = document.getElementById('days-30-plan');
            const days60 = document.getElementById('days-60-plan');
            const days90 = document.getElementById('days-90-plan');

            days30.innerHTML = `
                <li>Set up tracking and analytics for all channels</li>
                <li>Implement initial budget allocation</li>
                <li>Launch priority campaigns</li>
                <li>Establish baseline performance metrics</li>
            `;

            days60.innerHTML = `
                <li>Analyze first month performance data</li>
                <li>Optimize underperforming channels</li>
                <li>Scale successful campaigns</li>
                <li>Conduct A/B tests on ad creative and content</li>
            `;

            days90.innerHTML = `
                <li>Complete quarterly performance review</li>
                <li>Reallocate budget based on results</li>
                <li>Plan for next quarter expansion</li>
                <li>Document lessons learned and best practices</li>
            `;
        }

        function buildCustomPackage() {
            CalculatorUtils.showNotification('Custom package builder coming soon! Please use the budget allocation tool above for now.', 'info');
        }

        function updateProjections() {
            if (currentBudgetData.scores) {
                calculateProjections();
            }
        }

        function generateBudgetReport() {
            const totalBudget = parseFloat(document.getElementById('total-budget').value) || 0;

            const data = {
                'Total Monthly Budget': CalculatorUtils.formatCurrency(totalBudget),
                'Efficiency Score': (currentBudgetData.scores?.efficiency || 0) + '/100',
                'Projected ROI': (currentBudgetData.scores?.roi || 0) + '%',
                'Risk Level': currentBudgetData.scores?.risk || 'Unknown',
                'Analysis Date': new Date().toLocaleDateString()
            };

            CalculatorUtils.generatePDFReport('Budget Optimization', data);
        }

        function shareBudgetResults() {
            const totalBudget = parseFloat(document.getElementById('total-budget').value) || 0;

            const data = {
                'Budget': CalculatorUtils.formatCurrency(totalBudget),
                'Efficiency': (currentBudgetData.scores?.efficiency || 0) + '/100',
                'ROI': (currentBudgetData.scores?.roi || 0) + '%',
                'Risk': currentBudgetData.scores?.risk || 'Unknown'
            };

            CalculatorUtils.shareResults('My Marketing Budget Plan', data);
        }

        // Initialize with sample data
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('total-budget').value = '5000';
            document.getElementById('business-type').value = 'professional-services';
            document.getElementById('business-goals').value = 'lead-generation';
            updateAllocation();
        });
    </script>
</body>
</html>